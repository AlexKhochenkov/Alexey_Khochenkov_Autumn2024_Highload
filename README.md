# Программирование высоконагруженного сервиса напоминаний и планирования событий

# 1 Тема и целевая аудитория

## Тема

Google Calendar - сервис для планирования мероприятий, задач и встреч, позволяющий указывать подробную информацию и устанавливать напоминания, предоставляющий совместный доступ к планированию.

## MVP

1. Авторизация с помощью Google
2. Отображение календаря
3. Добавление новых мероприятий/задач
4. Редактирование информации о мероприятии (время, место и т. д.)
5. Установка напоминаний о событии
6. Прикрепление других пользователей к событию
7. Совместное отображение и редактирование календарей
8. Поиск по событиям

## ЦА

Размер целевой аудитории: около 500 млн. пользователей в месяц. [[1]](https://earthweb.com/blog/google-calendar-users/) [[3]](https://zipdo.co/google-calendar-statistics/)

Ниже приведена статистика по возрасту целевой аудитории, начиная с 18 лет [[2]](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/audience-demographics/*/999/1m?webSource=Total&key=calendar.google.com)
Возрастная группа | Процентное соотношение
------------ | -------------
18-24 года| 14,05% 
25-34 года| 29,47% 
35-44 года| 20,31%
45-54 года| 16,77%
55-64 года| 11,92%
65+| 7,48%

Гендерное распределение аудитории Google Calendar [[2]](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/audience-demographics/*/999/1m?webSource=Total&key=calendar.google.com):
Пол          | Процентное соотношение
-------------| -------------
Мужской      | 50,26%
Женский      | 49,74% 

Общемировая география пользователей Google Calendar [[2]](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/audience-geography/*/999/1m?key=calendar.google.com&webSource=Total):  
Регион           | Процентное соотношение
---------------- | -------------
США                     | 34,42%
Япония                  | 19,83% 
Бразилия                | 4,12% 
Объединённое королевство| 2,95% 
Канада                  | 2,9% 
Остальные               | 35,76%

# 2 Расчёт нагрузки

## Продуктовые метрики

Информация о DAU сервиса отсутствует в открытых источниках, поэтому примем, что DAU/MAU = 25%, так как сервис используется для планирования дневных задач и мероприятий, что предполагает частое использование. В таком случае DAU = 1/2MAU = 250 млн. пользователей.

Метрика      | Значение
-------------| -------------
Месячная аудитория MAU        | 500 млн. пользователей
Дневная аудитория DAU         | 125 млн. пользователей
Средняя длительность сессии   | 07:23 минут [[4]](https://webstatsdomain.org/d/calendar.google.com)

### Хранилище данных для пользователя

Сначала посчитаем вес одного события в календаре. Поскольку символы в UTF-8 могут кодироваться разным количеством байтов(от 1 до 4), а Google Calendar имеет многоязычную аудиторию, то можно взять средний размер символа равный 3 байтам.

Параметр          | Вес
-------------| -------------
Название                                   | 128 символов UTF-8
Описание                                   | 1024 символа UTF-8
Дата создания                              | 8 Б
Дата последнего обновления                 | 8 Б
Дата начала события                        | 8 Б
Дата окончания события                     | 8 Б
Ссылка на создателя                        | 8 Б
Email гостя                                | 255 Б
Максимальное количество гостей             | 20
Местоположение                             | 8 Б
Календарь                                  | 8 Б
Общий размер                               | 128 * 3 + 1024 * 3 + 8 + 8 + 8 + 8 + 8 + 255 * 20 + 8 + 8 = 8604 Б

В среднем каждый день средний пользователь среднего календаря создает 5 событий [[7]](https://reclaim.ai/blog/productivity-report-one-on-one-meetings).

По версии сайта marketsplash.com в среднем в день создаётся около 1.5 млрд событий. [[8]](https://web.archive.org/web/20240424130647/https://marketsplash.com/google-workspace-statistics/). Тогда, поделив это число на DAU, получим 1.5 млрд/125 млн = 12 событий.

События хранятся в памяти 1 год после завершения, поэтому на одного пользователя в среднем нужно: 

365 * 12 * 8604 Б = 35,94 Мб

Также есть лимит в 10000 событий, после которого старые события удаляются [[6]](https://classroom.synonym.com/google-calendar-limits-17378.html).

Посчитаем вес одного календаря.

Параметр          | Вес
-------------| -------------
Название                                   | 128 символов UTF-8
Описание                                   | 1024 символа UTF-8
Дата создания                              | 8 Б
Дата последнего обновления                 | 8 Б
Ссылка на создателя                        | 8 Б
Часовой пояс                               | 8 Б
Общий размер                               | 8 + 8 + 8 + 8 + 128 * 3 + 1024 * 3 = 3488 Б

На календари у пользователей также есть лимит в 25 штук [[6]](https://classroom.synonym.com/google-calendar-limits-17378.html).

25 * 3488 Б = 85,156 Кб

Посчитаем средний размер хранилища пользователя.

Параметр          | Вес
-------------| -------------
Добавление событий                         | 20 запросов/день
Получение напоминаний                      | 40 запросов/день
Размер событий                             | 35,94 Мб
Размер календарей                          | 85,156 Кб
Информация о пользователе                  | 1 Кб
Общий размер                               | 82,054 Мб + 85,156 Кб + 1 Кб = 82,138 Мб

## Технические метрики

### Размер хранения в разбивке по типам данных

Поскольку было найдено примерное количество пользователей, а MAU = 500 млн, то можно рассчитать примерный размер хранения по этим типам данных:

По событиям: 35,94 Мб * 500 млн = 17 137,3904 Тб = 16,73 Пб

По календарям: 25 * 3488 Б * 500 млн = 39,65 Тб

### Сетевой трафик

Следует учесть, что при добавлении гостя к событию, гостю приходит приглашение, а также то, что гость должен ответить на приглашение. Возьмём, что в среднем к событию прикрепляется один гость.

1. Просмотр календаря:

* 25 запросов/день. 25 * 3488 Б = 85,16 Кб

2. Добавление событий:

* 12 запросов/день. 12 * 8604 Б = 100,8 Кб

3. Получение напоминаний. Поскольку на одно событие приходится одно напомининие:

* 12 запросов/день. Оценим напоминание в 1 Кб. 12 * 1Кб = 12 Кб.

4. Получение приглашений. Поскольку на одно событие приходится одно приглашение:

* 12 запросов/день. Оценим приглашение в 1 Кб. 12 * 1Кб = 12 Кб.

5. Получение ответов на приглашение. Поскольку на одно событие приходится одно приглашение:

* 12 запросов/день. Оценим ответ на приглашение в 1 Кб. 12 * 1Кб = 12 Кб.

### Сетевой трафик по видам активности в виде таблицы

Пиковое значение пользователей можно оценить примерно в 2 раза. Возьмём запас в 2.5.

DAU = 125 млн.

Тип                           | Отправка  | Отправка Гб/сек | Пиковое значение Гб/сек |
-------------                 | ------------------------------------  |--------------- |----------------- |
Просмотр календаря            | 125 млн * 85,16 Кб = 10 151,8 Гб      | 0.117          | 0.294            |
Добавление событий            | 125 млн * 100,8 Кб = 12 016,3 Гб      | 0.139          | 0.348            | 
Получение напоминаний         | 125 млн * 12 Кб = 1430,5 Гб           | 0.017          | 0.041            | 
Получение приглашений         | 125 млн * 12 Кб = 1430,5 Гб           | 0.017          | 0.041            |
Получение ответов на приглашения         | 125 млн * 12 Кб = 1430,5 Гб           | 0.017          | 0.041            |
Итого                         | 26 460 Гб	                            | 0.306          | 0.766            |

### RPS

Тип                                 | RPS  | Пиковое значение |
------------------------------------| ---  |----------------- |
Просмотр календаря                  | 125 млн * 25 / 86400 сек = 36 169   | 90 423            |
Добавление событий                  | 125 млн * 12 / 86400 сек = 17 361   | 43 403            |
Получение напоминаний               | 125 млн * 12 / 86400 сек = 17 361   | 43 403            |
Получение приглашений               | 125 млн * 12 / 86400 сек = 17 361   | 43 403            |
Получение ответов на приглашения    | 125 млн * 12 / 86400 сек = 17 361   | 43 403            |
Итого                               | 125 млн * 73 / 86400 сек = 105 613  | 264 034           |



# Список источников

1. https://earthweb.com/blog/google-calendar-users/
2. https://pro.similarweb.com/#/digitalsuite/websiteanalysis/audience-demographics/*/999/1m?webSource=Total&key=calendar.google.com
3. https://zipdo.co/google-calendar-statistics/
4. https://webstatsdomain.org/d/calendar.google.com
5. https://www.template.net/google/how-long-does-google-calendar-keep-past-events/
6. https://classroom.synonym.com/google-calendar-limits-17378.html
